<div class="row">
  <div class="col-md-5 col-sm-12">
    <div widget class="card border-0 box-shadow">
      <div class="card-header transparent border-0 text-muted">
        <h5 class="mb-0">Formulario de Empresas
          <span *ngIf="empresa._id && empresa._id != ''"> - [Edición]</span>
          <span *ngIf="!empresa._id || empresa._id == ''"> - [Ingreso]</span></h5>
        <div class="widget-controls">
          <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
          <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>
          <a data-widgster="fullscreen" href="#" class="transition"><i class="fa fa-expand"></i></a>
          <a data-widgster="restore" href="#" class="transition"><i class="fa fa-compress"></i></a>
          <!-- <a data-widgster="close" href="#" class="transition"><i class="fa fa-times"></i></a> -->
        </div>
      </div>
      <div class="card-body widget-body">
        <div class="row">
          <div *ngFor="let step of steps; let last = last" class="col-sm-12 col-md-4 col-12 step text-center">
            <div class="d-flex justify-content-center align-items-center text-white pl-2 pr-2 mb-2 rounded step-content"
              [class.bg-success]="step.valid" [class.bg-danger]="step.active" [class.confirmed]="confirmed">
              <i class="fa {{ step.icon }} mr-2" aria-hidden="true"></i>
              <span class="step-name">{{step.name}}</span>
            </div>
          </div>
        </div>

        <div *ngFor="let step of steps" [hidden]="!step.active" class="col">
          <div class="row">
            <h4 class="mt-3 mb-3"><i class="fa {{ step.icon }}"></i> {{step.name}}</h4>
          </div>

          <form *ngIf="step.name=='Detalles'" class="row col-12 bg-light pt-2">
            <label for="" class="label-form col-md-4 col-sm-12">Nombre de la Empresa:*</label>
            <div class="input-group col-md-8 col-sm-12 mb-2">
              <input  [disabled]="empresa._id != ''" type="text" id="EmpName" name="EmpName" #EmpName=ngModel [(ngModel)]="empresa.Name"
                class="form-control"[class.is-invalid]="EmpName.touched && !EmpName.valid && nemp_correcta === false"
                [class.is-valid]="(EmpName.touched && EmpName.valid && nemp_correcta === true)" (change)="empUnica(EmpName.value)"
                (keyup)="empUnica(EmpName.value)">
                <span *ngIf="nemp_correcta === false" class="col-md-12 col-sm-12 badge badge-danger">
                  | La Empresa ingresada ya Existe!
                </span>  
            </div>
            <label for="" class="label-form col-md-4 col-sm-12">Direcci&oacute;n:*</label>
            <div class="input-group col-md-8 col-sm-12 mb-2">
              <button (click)="initMap()" class="btn btn-block" [class.btn-info]="!empresa.GPS" [class.btn-success]="empresa.GPS" id="toEdit" data-toggle="modal" data-target="#maps-modal">
                <i class="fas fa-map-marker-alt"></i>
                &nbsp;
                <span *ngIf="!empresa.GPS">Elegir Dirección</span>
                <span *ngIf="empresa.GPS">{{JSONParse(empresa.GPS).formatted_address}}</span>
              </button>
            </div>
          </form>

          <form *ngIf="step.name=='Representante Legal'" class="row bg-light pt-2">
            <!-- <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input checkbox-info" id="isPrev" [checked]="isPrev"
                (change)="isPrev = !isPrev">
              <label class="custom-control-label mb-3" for="isPrev">
                El Representante Legal ya estaba registrado como Persona en el sistema
              </label>
              <br>
            </div> -->
            <div class="container" *ngIf="isPrev">
              <div class="input-group mb-2">
                <span class="input-group-prepend">
                  <span class="input-group-text bg-transparent border-0"><i class="fa fa-search ml-2 mr-1"></i></span>
                </span>
                <input class="form-control border-0" type="text" id=searchText name=searchText (change)="definePer();"
                  (keyup)="definePer();" [(ngModel)]="searchTextPer" placeholder="{{searchTitlePer}}">
                <div class="btn-group">
                  <button type="button" class="btn dropdown-toggle no-caret bg-transparent border-0 box-shadow-none"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-ellipsis-v"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu-right box-shadow rounded-0">
                    <a class="dropdown-item" href="javascript:void(0);" (click)="typePer = 'all'; definePer();">Todo</a>
                    <a class="dropdown-item" href="javascript:void(0);"
                      (click)="typePer = 'phone'; definePer();">Tel&eacute;fono</a>
                    <a class="dropdown-item" href="javascript:void(0);"
                      (click)="typePer = 'name'; definePer();">Nombres</a>
                    <a class="dropdown-item" href="javascript:void(0);"
                      (click)="typePer = 'lastname'; definePer();">Apellidos</a>
                    <a class="dropdown-item" href="javascript:void(0);"
                      (click)="typePer = 'ci'; definePer();">C&eacute;dula</a>
                    <a class="dropdown-item" href="javascript:void(0);"
                      (click)="typePer = 'address'; definePer();">Direcci&oacute;n</a>
                  </div>
                </div>
              </div>
              <table *ngIf="Personas && Personas.length >=1 "
                class="table table-responsive table-striped table-sm table-hover">
                <thead>
                  <tr>
                    <th>&nbsp;&nbsp;</th>
                    <th [class.gray-highlight]="typePer != 'all' && typePer !='phone'">Télefono</th>
                    <th [class.gray-highlight]="typePer != 'all' && typePer !='name'">Nombres</th>
                    <th [class.gray-highlight]="typePer != 'all' && typePer !='lastname'">Apellidos</th>
                    <th [class.gray-highlight]="typePer != 'all' && typePer !='ci'">Cédula</th>
                    <th [class.gray-highlight]="typePer != 'all' && typePer !='address'">Dirección</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let personaItem of Personas; let i=index" class="selectable"
                    [class.bg-success-ligth]="empresa.Representante == personaItem._id"
                    (click)="empresa.Representante = personaItem._id; currDueno = personaItem">
                    <th [class.bg-deleted]="!personaItem.Active"
                      (click)="empresa.Representante = personaItem._id; currDueno = personaItem" scope="row">
                      <button class="btn">
                        <i *ngIf="empresa.Representante == personaItem._id"
                          class="fa fa-check-square-o text-success"></i>
                        <i *ngIf="empresa.Representante != personaItem._id" class="fa fa-square-o text-primary"></i>
                      </button>
                    </th>
                    <td [class.gray-highlight]="typePer != 'all' && typePer !='phone'"
                      [class.bg-deleted]="!personaItem.Active">{{personaItem.Phone}}</td>
                    <td [class.gray-highlight]="typePer != 'all' && typePer !='name'"
                      [class.bg-deleted]="!personaItem.Active">{{personaItem.FirstName}}</td>
                    <td [class.gray-highlight]="typePer != 'all' && typePer !='lastname'"
                      [class.bg-deleted]="!personaItem.Active">{{personaItem.LastName}}</td>
                    <td [class.gray-highlight]="typePer != 'all' && typePer !='ci'"
                      [class.bg-deleted]="!personaItem.Active">{{personaItem.Ci}}</td>
                    <td [class.gray-highlight]="typePer != 'all' && typePer !='address'"
                      [class.bg-deleted]="!personaItem.Active">
                      <span *ngIf="personaItem.GPS">
                        {{JSONParse(personaItem.GPS).address_components[0].long_name}} -
                        {{JSONParse(personaItem.GPS).address_components[1].long_name}} -
                        {{JSONParse(personaItem.GPS).address_components[2].long_name}} -
                        {{JSONParse(personaItem.GPS).address_components[3].long_name}} 
                        <span *ngIf="JSONParse(personaItem.GPS).address_components[4]">
                          - {{JSONParse(personaItem.GPS).address_components[4].long_name}} 
                        </span>
                        <span *ngIf="JSONParse(personaItem.GPS).address_components[5]">
                          - {{JSONParse(personaItem.GPS).address_components[5].long_name}} 
                        </span>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div *ngIf="!Personas || Personas.length < 1" role="alert" class="alert alert-dismissible fade show"
                [class.alert-danger]="searchTextPer == ''" [class.alert-warning]="searchTextPer != ''">
                <button type="button" data-dismiss="alert" aria-label="Close" class="close">
                  <span aria-hidden="true">×</span>
                </button>
                <span *ngIf="searchTextPer != ''">
                  <strong>Sin Resultados!</strong> Al parecer la Busqueda no ha devuelto ningún resultado
                </span>
                <span *ngIf="searchTextPer == ''">
                  <strong>Sin Personas!</strong> Al parecer no se han Registrado Personas en el Sistema o hubo un Error
                  en
                  el Servidor
                </span>
              </div>
            </div>

            <div class="container" *ngIf="!isPrev">
              <form *ngIf="!currDueno" action="" class="pr-4" #Form=ngForm name="Form" id="Form">
                <div class="row">
                  <label class="col-md-4 col-sm-12 label-form" for="">Nombres*</label>
                  <input class="col-md-8 col-sm-12 form-control" placeholder="Nombres de la Persona"
                    pattern="[A-Za-z ñÑáÁéÉíÍóÓúÚüÜ]{3,25}" name=FirstName id=FirstName
                    [class.is-invalid]="FirstName.touched && !FirstName.valid"
                    [class.is-valid]="FirstName.touched && FirstName.valid" minlength="3" maxlength="25" required
                    #FirstName=ngModel [(ngModel)]=newDueno.FirstName type="text">
                </div>
                <br>
                <div class="row">
                  <label class="col-md-4 col-sm-12 label-form" for="">Apellidos</label>
                  <input class="col-md-8 col-sm-12 form-control" pattern="[A-Za-z ñÑáÁéÉíÍóÓúÚüÜ]{3,25}"
                    placeholder="Apellidos de la Persona" name=LastName id=LastName #LastName=ngModel minlength="3"
                    maxlength="25" [class.is-invalid]="LastName.touched && !LastName.valid"
                    [class.is-valid]="LastName.touched && LastName.valid  && LastName.value != ''"
                    [(ngModel)]=newDueno.LastName type="text">
                </div>
                <br>
                <div class="row">
                  <label class="col-md-4 col-sm-12 label-form" for="">Cédula</label>
                  <input class="col-md-8 col-sm-12 form-control" placeholder="Cédula de la Persona" name=Ci id=Ci
                    #Ci=ngModel pattern="[0-9]{10,10}" (change)="comprobar_ci(Ci.value); cedulaUnica(Ci.value)"
                    (keyup)="comprobar_ci(Ci.value) ;cedulaUnica(Ci.value)"
                    [class.is-invalid]="ci_correcta === false && ci_unica == false"
                    [class.is-valid]="ci_correcta === true && ci_unica == true" minlength="10" maxlength="10"
                    [disabled]="newDueno._id != ''" required [(ngModel)]=newDueno.Ci type="text">
                  <span *ngIf="ci_correcta === false && no === true"
                    class="col-md-8 col-sm-12 offset-3 badge badge-danger">
                    | La cedula Ingresada es Incorrecta
                  </span>
                  <span *ngIf="ci_unica === false" class="col-md-8 col-sm-12 offset-3 badge badge-danger">
                    | La cedula Ingresada es ya Existe!
                  </span>
                  <span *ngIf="ci_correcta === true && ci_unica == true"
                    class="col-md-8 col-sm-12 offset-3 badge badge-success">
                    Cedula Correcta!!
                  </span>
                  <span *ngIf="no === false" class="col-md-8 col-sm-12 offset-3 badge badge-success">
                    Cedula no es obligatoria!!
                  </span>
                </div>
                <br>
                <div class="row">
                  <label class="col-md-4 col-sm-12 label-form" for="">Teléfono*</label>
                  <input class="col-md-8 col-sm-12 form-control" placeholder="Teléfono de la Persona"
                    pattern="[0-9]{9,13}" name=Phone id=Phone #Phone=ngModel
                    [class.is-invalid]="Phone.touched && !Phone.valid && ph_correcta === false"
                    [class.is-valid]="(Phone.touched && Phone.valid && ph_correcta === true)"
                    (change)="telfUnica(Phone.value)" (keyup)="telfUnica(Phone.value)" minlength="9" maxlength="10"
                    required [(ngModel)]=newDueno.Phone type="text">
                  <span *ngIf="ph_correcta === false" class="col-md-8 col-sm-12 offset-3 badge badge-danger">
                    | El telefono ingresado ya Existe!
                  </span>
                </div>
                <br>
                <div class="row">
                  <label class="col-md-4 col-sm-12 label-form" for="">Dirección</label>
                  <input class="col-md-8 col-sm-12 form-control" placeholder="Dirección de la Persona"
                    pattern="[a-zA-z0-9 ñÑáÁéÉíÍóÓúÚüÜ]{3,25}" name=Address id=Address #Address=ngModel
                    [class.is-invalid]="Address.touched && !Address.valid"
                    [class.is-valid]="Address.touched && Address.valid && Address.value != ''" minlength="3"
                    maxlength="45" [(ngModel)]=newDueno.Address type="text">
                </div>
                <br>
                <div class="text-center">
                  <button class="btn btn-success option-button pull-left" [disabled]="!Form.form.valid"
                    (click)="onSubmitNewDueno()"><span *ngIf="newDueno._id != null && newDueno._id !== ''">Editar</span>
                    <span *ngIf="newDueno._id == null || newDueno._id == ''">Registrar</span></button>
                  <button class="btn btn-primary option-button pull-right" (click)="initDueno()">Cancelar</button>
                </div>
              </form>
              <div *ngIf="currDueno">
                <h3>Datos del Representante Legal [Dueño]:</h3>
                <br>
                <strong>Nombres: </strong> {{currDueno.FirstName + ' ' + currDueno.LastName}}.&nbsp;
                <br>
                <strong>Cédula: </strong> {{currDueno.Ci}}.&nbsp;
                <br>
                <strong>Teléfono: </strong> {{currDueno.Phone}}.&nbsp;
                <br>
                <strong>Dirección: </strong> 
                <!-- {{currDueno.City.Canton.Name}} - {{currDueno.City.Canton.Provincia.Name}} -->
                <span *ngIf="currDueno.GPS">
                  {{JSONParse(currDueno.GPS).address_components[0].long_name}},
                  {{JSONParse(currDueno.GPS).address_components[1].long_name}} -
                  {{JSONParse(currDueno.GPS).address_components[2].long_name}} -
                  {{JSONParse(currDueno.GPS).address_components[3].long_name}} 
                  <span *ngIf="JSONParse(currDueno.GPS).address_components[4]">
                    - {{JSONParse(currDueno.GPS).address_components[4].long_name}} 
                  </span>
                  <span *ngIf="JSONParse(currDueno.GPS).address_components[5]">
                    - {{JSONParse(currDueno.GPS).address_components[5].long_name}} 
                  </span>
                  <span *ngIf="JSONParse(currDueno.GPS).address_components[6]">
                    - {{JSONParse(currDueno.GPS).address_components[6].long_name}} 
                  </span>
                </span>
                <br>
                <div class="text-center">
                  <button class="btn btn-success pull-left" (click)="isPrev = !isPrev">
                    Seleccionar Otro Representante Legal
                  </button>
                  <!-- <button class="btn btn-danger pull-right" (click)="currDueno = undefined">
                    Ingresar Nuevo Representante Legal
                  </button> -->
                </div>
              </div>
            </div>

          </form>

          <form *ngIf="step.name == 'Administrador'"class="row bg-light pt-2">
            <div class="input-group mb-2">
              <span class="input-group-prepend">
                <span class="input-group-text bg-transparent border-0"><i class="fa fa-search ml-2 mr-1"></i></span>
              </span>
              <input class="form-control border-0" type="text" id=searchTextUsers name=searchTextUsers (change)="defineUsers();"
                (keyup)="defineUsers();" [(ngModel)]="searchTextUsers" placeholder="{{searchTitleUsers}}">
              <div class="btn-group">
                <button type="button" class="btn dropdown-toggle no-caret bg-transparent border-0 box-shadow-none"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fa fa-ellipsis-v"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-right box-shadow rounded-0">
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'all'     ; defineUsers();">Todo</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'mail'    ; defineUsers();">Tel&eacute;fono</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'phone'   ; defineUsers();">Tel&eacute;fono</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'name'    ; defineUsers();">Nombres</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'lastname'; defineUsers();">Apellidos</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'ci'      ; defineUsers();">C&eacute;dula</a>
                  <a class="dropdown-item" href="javascript:void(0);" (click)="typeUsers = 'address' ; defineUsers();">Direcci&oacute;n</a>
                </div>
                <button *ngIf="empresa.Admin != ''" class="ml-1 btn no-caret bg-transparent border-0  btn-sm" (click)="empresa.Admin = ''" >
                  Borrar Admin
                </button>
              </div>
            </div>

            <table class="table table-striped table-bordered table-sm table-responsive" >
              <thead>
                <tr>
                  <th>&nbsp;</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='phone'">Télefono</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='mail'">Correo Electrónico</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='name'">Nombres</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='lastname'">Apellidos</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='ci'">Cédula</th>
                  <th [class.gray-highlight]="typeUsers != 'all' && typeUsers !='address'">Dirección</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let usuario of Usuarios; let i=index" class="selectable"
                    [class.bg-success-ligth]="empresa.Admin == usuario._id"
                    (click)="empresa.Admin = usuario._id; currAdmin = usuario">
                    <th [class.bg-deleted]="!usuario.Active"
                      (click)="empresa.Admin = usuario._id; currAdmin = usuario" scope="row">
                      <button class="btn">
                        <i *ngIf="empresa.Admin == usuario._id"
                          class="fa fa-check-square-o text-success"></i>
                        <i *ngIf="empresa.Admin != usuario._id" class="fa fa-square-o text-primary"></i>
                      </button>
                    </th>
                    <td [class.gray-highlight]="typeUsers != 'all' && typeUsers !='phone'"
                      [class.bg-deleted]="!usuario.Active">{{usuario.Persona.Phone}}</td>
                    <td [class.gray-highlight]="typeUsers != 'all' && typeUsers !='mail'"
                      [class.bg-deleted]="!usuario.Active">{{usuario.Email}}</td>
                    <td [class.gray-highlight]="typeUsers != 'all' && (typeUsers !='name' && typeUsers !='lastname')"
                      [class.bg-deleted]="!usuario.Active">{{usuario.Persona.FirstName + ' ' + usuario.Persona.LastName}}</td>
                    <!-- <td [class.gray-highlight]="typeUsers != 'all' && "
                      [class.bg-deleted]="!usuario.Active">{{}}</td> -->
                    <td [class.gray-highlight]="typeUsers != 'all' && typeUsers !='ci'"
                      [class.bg-deleted]="!usuario.Active">{{usuario.Persona.Ci}}</td>
                    <td [class.gray-highlight]="typeUsers != 'all' && typeUsers !='address'"
                      [class.bg-deleted]="!usuario.Active">
                      {{usuario.Persona.Address}}.
                    </td>
                  </tr>
              </tbody>
            </table>

          </form>
        </div>

        <div class="row mt-3">
          <div class="col">
            <button *ngIf="!steps[0].active" class="btn btn-primary pull-left" (click)="prev()">
              <i class="fa fa-chevron-left arrow"></i>
              &nbsp; Regresar
            </button>
            <button class="btn btn-warning pull-left ml-1" (click)="cleanData()">
              <i class="fa fa-trash arrow"></i>&nbsp; 
              Limpiar Datos
            </button>
            <button *ngIf="!steps[steps.length-1].active" [disabled]="!checkDetalles() || ( steps[1].active == true && !checkData()) || nemp_correcta === false"
              class="btn btn-primary pull-right" (click)="next()">
              Siguiente &nbsp;
              <i class="fa fa-chevron-right arrow"></i>
            </button>
            <button *ngIf="steps[steps.length-1].active" [disabled]='!checkData()' data-toggle="modal"
              data-target="#warning-modal" class="btn btn-primary pull-right" (click)="initInfoMap(); currEmpresa = empresa" >
              Confirmar &nbsp;
              <i class="fa fa-check arrow"></i>
            </button>
          </div>
        </div>

      </div>

    </div>
  </div>
  <div class="col-md-7 col-sm-12">
    <div widget class="card border-0 box-shadow">
      <div class="card-header transparent border-0 text-muted">
        <h5 class="mb-0">Listado de Empresas</h5>
        <div class="widget-controls">
          <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
          <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>
          <a data-widgster="fullscreen" href="#" class="transition"><i class="fa fa-expand"></i></a>
          <a data-widgster="restore" href="#" class="transition"><i class="fa fa-compress"></i></a>
          <!-- <a data-widgster="close" href="#" class="transition"><i class="fa fa-times"></i></a> -->
        </div>
      </div>
      <div class="card-body widget-body bg-light">
        <div  *ngIf="BufferEmpresas && BufferEmpresas.length >= 1 " class="input-group mb-2">
          <span class="input-group-prepend">
            <span class="input-group-text bg-transparent border-0"><i class="fa fa-search ml-2 mr-1"></i></span>
          </span>
          <input class="form-control border-0" type="text" id=searchTextEmp name=searchTextEmp (change)="defineEmp();"
            (keyup)="defineEmp();" [(ngModel)]="searchTextEmp" placeholder="{{searchTitleEmp}}">
          <div class="btn-group">
            <button type="button" class="btn dropdown-toggle no-caret bg-transparent border-0 box-shadow-none"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-menu dropdown-menu-right box-shadow rounded-0">
              <a class="dropdown-item" href="javascript:void(0);" (click)="typeEmp = 'all'    ; defineEmp();">Todo</a>
              <a class="dropdown-item" href="javascript:void(0);" (click)="typeEmp = 'name'   ; defineEmp();">Nombre
                Empresa</a>
              <a class="dropdown-item" href="javascript:void(0);" (click)="typeEmp = 'ci'     ; defineEmp();">RUC</a>
              <!-- <a class="dropdown-item" href="javascript:void(0);" (click)="typeEmp = 'nameRep'; defineEmp();">Nombre Representante</a> -->
              <a class="dropdown-item" href="javascript:void(0);"
                (click)="typeEmp = 'address'; defineEmp();">Direcci&oacute;n</a>
            </div>
          </div>
        </div>
        <table *ngIf="Empresas && Empresas.length >= 1 " class="table table-striped table-bordered table-responsive-sm">
          <thead>
            <tr>
              <th class="p-0 text-center">#</th>
              <th class="p-0 text-center">RUC</th>
              <th class="p-0 text-center">Nombre</th>
              <th class="p-0 text-center">Direcci&oacute;n</th>
              <th class="p-0 text-center">Representante</th>
              <th class="p-0 text-center">Administrador</th>
              <th class="p-0 text-center" colspan="3">Opciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of Empresas | paginate: paginationDataEmpresas; let i = index;">
              <td class="p-0" [class.bg-deleted]="!item.Active">{{i+1}}</td>
              <td class="p-0" [class.bg-deleted]="!item.Active">
                {{item.Representante.Ci + '-' + item.RUC}}
              </td>
              <td class="p-0" [class.bg-deleted]="!item.Active">
                {{item.Name}}
              </td>
              <td class="p-0" [class.bg-deleted]="!item.Active">
                <!-- {{item.Address}}, En:  -->
                <span *ngIf="item.GPS">
                  {{JSONParse(item.GPS).address_components[0].long_name}} -
                  {{JSONParse(item.GPS).address_components[1].long_name}} -
                  {{JSONParse(item.GPS).address_components[2].long_name}} -
                  {{JSONParse(item.GPS).address_components[3].long_name}} 
                  <span *ngIf="JSONParse(item.GPS).address_components[4]">
                    - {{JSONParse(item.GPS).address_components[4].long_name}} 
                  </span>
                  <span *ngIf="JSONParse(item.GPS).address_components[5]">
                    - {{JSONParse(item.GPS).address_components[5].long_name}} 
                  </span>
                </span>
              </td>
              <td class="p-0" [class.bg-deleted]="!item.Active">
                {{item.Representante.Ci}} - {{item.Representante.FirstName}} {{item.Representante.LastName}}
              </td>
              <td class="p-0" [class.bg-deleted]="!item.Active">
                <span *ngIf="item.Admin"> {{item.Admin.Email}} -
                  {{item.Admin.Persona.FirstName + ' ' + item.Admin.Persona.LastName}} </span>
                <span *ngIf="!item.Admin"> Sin Administrador</span>
              </td>
              <td [class.bg-deleted]="!item.Active" class="text-center p-0">
                <button data-toggle="tooltip" data-html="true" title="Editar Cliente"
                  class="btn btn-sm btn-primary btn-block pl-1 pr-1" (click)="toUpdate(item)"><i class="fa fa-edit"></i>
                </button>
              </td>
              <td [class.bg-deleted]="!item.Active" class="text-center p-0">
                <button class="btn  btn-sm  btn-block pl-1 pr-1" data-toggle="tooltip" data-html="true"
                  title="Activar/Desactivar Cliente" [class.btn-outline-warning]="item.Active == true"
                  [class.btn-warning]="item.Active == false" (click)="Delete(item)">
                  <i *ngIf="item.Active == false" class="fa fa-eye"></i>
                  <i *ngIf="item.Active == true" class="fa fa-eye-slash"></i>
                </button>
              </td>
              <td [class.bg-deleted]="!item.Active" class="text-center p-0">
                <button title="Detalles de la Empresa" type="button" class="btn btn-sm btn-info  btn-block pl-2 pr-2"
                  (click)="infoEmpresa(item)" data-toggle="modal" data-target="#info-modal">
                  <i class="fa fa-info"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <pagination-controls id="empresas_tbl" class="text-center" maxSize="3" directionLinks="true" autoHide="true"
          responsive="true" previousLabel="Atrás" nextLabel="Siguiente" screenReaderPaginationLabel="Pagination"
          screenReaderPageLabel="page" screenReaderCurrentLabel="You're on page"
          (pageBoundsCorrection)="paginationDataEmpresas.currentPage = $event"
          (pageChange)="paginationDataEmpresas.currentPage = $event"></pagination-controls>

        <div *ngIf="!Empresas || Empresas.length < 1" role="alert" class="alert alert-dismissible fade show"
        [class.alert-danger]="!searchTextEmp || searchTextEmp == ''" [class.alert-warning]="searchTextEmp && searchTextEmp != ''">
          <button type="button" data-dismiss="alert" aria-label="Close" class="close">
            <span aria-hidden="true">×</span>
          </button>
          <span *ngIf="searchTextEmp && searchTextEmp != ''">
            <strong>Sin Resultados!</strong> Al parecer la Busqueda no ha devuelto ningún resultado
          </span>
          <span *ngIf="!searchTextEmp || searchTextEmp == ''">
            <strong>Sin Empresas!</strong> Al parecer no se han Registrado Empresas en el Sistema o hubo un Error en el Servidor
          </span>
        </div>

      </div>
    </div>
  </div>
</div>

<div *ngIf="empresa && currDueno" class="modal fade" id="warning-modal" tabindex="0" role="dialog"
  aria-labelledby="modal-warning-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header state modal-warning">
        <h4 class="modal-title" id="modal-warning-label"><i class="fa fa-exclamation"></i>Alerta de Ingreso!</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>

      <div name=MyGoogleMapInfo id=MyGoogleMapInfo style="width: 100%; height: 500px;" class="modal-body">
        <!-- <div></div> -->
      </div>

      <div class="modal-body">
        <div class="container row m-0">
          <div class="col-12">
            <h4>Datos de la Empresa:</h4>
          </div>
          <div class="col-12">
            <strong>Nombre: </strong> {{empresa.Name}}
          </div>
          <div class="col-12">
            <strong>Dirección: </strong>  <span *ngIf="empresa.GPS">
              {{JSONParse(empresa.GPS).address_components[0].long_name}},
              {{JSONParse(empresa.GPS).address_components[1].long_name}} -
              {{JSONParse(empresa.GPS).address_components[2].long_name}} -
              {{JSONParse(empresa.GPS).address_components[3].long_name}} 
              <span *ngIf="JSONParse(empresa.GPS).address_components[4]">
                - {{JSONParse(empresa.GPS).address_components[4].long_name}} 
              </span>
              <span *ngIf="JSONParse(empresa.GPS).address_components[5]">
                - {{JSONParse(empresa.GPS).address_components[5].long_name}} 
              </span>
              <span *ngIf="JSONParse(empresa.GPS).address_components[6]">
                - {{JSONParse(empresa.GPS).address_components[6].long_name}} 
              </span>
            </span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="container row m-0">
          <div class="col-12">
            <h4>Representante Legal</h4>
          </div>
          <div class="col-12">
            <strong>Nombres: </strong> {{currDueno.FirstName + ' ' + currDueno.LastName}}.&nbsp;
          </div>
          <div class="col-12">
            <strong>Cédula: </strong> {{currDueno.Ci}}.&nbsp;
          </div>
          <div class="col-12">
            <strong>Teléfono: </strong> {{currDueno.Phone}}.&nbsp;
          </div>
          <div class="col-12">
            <strong>Dirección: </strong>  <span *ngIf="currDueno.GPS">
              {{JSONParse(currDueno.GPS).address_components[0].long_name}},
              {{JSONParse(currDueno.GPS).address_components[1].long_name}} -
              {{JSONParse(currDueno.GPS).address_components[2].long_name}} -
              {{JSONParse(currDueno.GPS).address_components[3].long_name}} 
              <span *ngIf="JSONParse(currDueno.GPS).address_components[4]">
                - {{JSONParse(currDueno.GPS).address_components[4].long_name}} 
              </span>
              <span *ngIf="JSONParse(currDueno.GPS).address_components[5]">
                - {{JSONParse(currDueno.GPS).address_components[5].long_name}} 
              </span>
              <span *ngIf="JSONParse(currDueno.GPS).address_components[6]">
                - {{JSONParse(currDueno.GPS).address_components[6].long_name}} 
              </span>
            </span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="container row m-0">
          <div class="col-12">
            <h4>Datos Legales</h4>
          </div>
          <label for="RUC" class="label-form text-right col-2"><strong>RUC:</strong></label>
          <div class="input-group col-5">
            <div class="input-group-prepend">
              <div class="input-group-text">
                {{currDueno.Ci}}
              </div>
            </div>
            <input class="form-control" type="text" id="RUC" name="RUC" #RUC=ngModel [(ngModel)]="empresa.RUC"
              maxlength="3" minlength="3">
          </div>
        </div>
      </div>
      <div *ngIf="currAdmin && empresa.Admin" class="modal-footer">
        <div class="container row m-0">
          <div class="col-12">
            <h4>Administrador</h4>
          </div>
          <div class="col-12">
            <strong>Correo Electrónico:</strong> {{currAdmin.Email}}
          </div>
          <div class="col-12">
            <strong>Nombres:</strong> {{currAdmin.Persona.FirstName + ' ' + currAdmin.Persona.LastName}}
          </div>
          <div class="col-12">
            <strong>Cédula:</strong> {{currAdmin.Persona.Ci}}
          </div>
          <div class="col-12">
            <strong>Teléfono:</strong> {{currAdmin.Persona.Phone}}
          </div>
          <div class="col-12">
            <strong>Dirección:</strong>  <span *ngIf="currAdmin.Persona.GPS">
              {{JSONParse(currAdmin.Persona.GPS).address_components[0].long_name}},
              {{JSONParse(currAdmin.Persona.GPS).address_components[1].long_name}} -
              {{JSONParse(currAdmin.Persona.GPS).address_components[2].long_name}} -
              {{JSONParse(currAdmin.Persona.GPS).address_components[3].long_name}} 
              <span *ngIf="JSONParse(currAdmin.Persona.GPS).address_components[4]">
                - {{JSONParse(currAdmin.Persona.GPS).address_components[4].long_name}} 
              </span>
              <span *ngIf="JSONParse(currAdmin.Persona.GPS).address_components[5]">
                - {{JSONParse(currAdmin.Persona.GPS).address_components[5].long_name}} 
              </span>
              <span *ngIf="JSONParse(currAdmin.Persona.GPS).address_components[6]">
                - {{JSONParse(currAdmin.Persona.GPS).address_components[6].long_name}} 
              </span>
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <small class="text-danger justify text-justify">*Al Hacer click en "Guardar Datos de la Empresa" esta aceptando
          que la información anteriormente mostrada y/o registrada concuerda con los datos Reales de la Empresa</small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" [disabled]="!checkRuc()" data-dismiss="modal"
          (click)="onSubmit()">
          <span *ngIf="empresa._id != ''">Guardar Datos de la Empresa</span>
          <span *ngIf="!empresa._id || empresa._id == ''">Editar Datos de la Empresa</span>
        </button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div id="info-modal" tabindex="-1" role="dialog" aria-labelledby="modal-info-label" class="modal fade">
  <div role="document" class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header state modal-info">
        <h4 id="modal-info-label" class="modal-title">
          <i class="fa fa-info"></i>
          Info Modal
        </h4>
        <button type="button" data-dismiss="modal" aria-label="Close" class="close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div name=MyGoogleMapInfo id=MyGoogleMapInfo style="width: 100%; height: 500px;" class="modal-body">
        <div></div>
      </div>
      <!-- <div *ngIf="currEmpresa" class="modal-body container row m-2">
        <h4 class="col-12">
          <strong>Empresa: </strong>
          {{currEmpresa.Name}} - {{currEmpresa.Representante.Ci +'-'+currEmpresa.RUC}}
        </h4>
        <label for="" class="label-form col-md-5 col-sm-12"> <strong>Dirección o Area de Funcionamiento: </strong></label>
        <label for="" class="label-form col-md-7 col-sm-12"> {{currEmpresa.Address +', En: ' + currEmpresa.City.Name + ' - ' + currEmpresa.City.Canton.Name + ' - ' + currEmpresa.City.Canton.Provincia.Name}}</label>
      </div>
      <div *ngIf="currEmpresa" class="modal-footer m-0 p-0">
      </div>
      <div *ngIf="currEmpresa" class="modal-body container row m-2">
        <h4 class="col-12">
          <strong>Representante: </strong>
          {{currEmpresa.Representante.FirstName + ' ' +currEmpresa.Representante.LastName}}
        </h4>
          <label for="" class="label-form col-md-1 col-sm-12"> <strong>Cédula: </strong></label>
          <label for="" class="label-form col-md-2 col-sm-12"> {{currEmpresa.Representante.Ci}}</label>
          <label for="" class="label-form col-md-1 col-sm-12"> <strong>Teléfono: </strong></label>
          <label for="" class="label-form col-md-2 col-sm-12"> {{currEmpresa.Representante.Phone}}</label>
          <label for="" class="label-form col-md-1 col-sm-12"> <strong>Dirección: </strong></label>
          <label for="" class="label-form col-md-5 col-sm-12 pl-md-4"> {{currEmpresa.Representante.Address  +', En: ' + currEmpresa.Representante.City.Name + ' - ' + currEmpresa.Representante.City.Canton.Name + ' - ' + currEmpresa.Representante.City.Canton.Provincia.Name}}</label>
      </div>
      <div *ngIf="currEmpresa" class="modal-footer m-0 p-0">
      </div>
      <div *ngIf="currEmpresa" class="modal-body container row m-2">
        <h4 class="col-12">
          <strong>Administrador: </strong>
          {{currEmpresa.Admin.Persona.FirstName + ' ' + currEmpresa.Admin.Persona.LastName}}
        </h4>
        <label for="" class="label-form col-md-3 col-sm-12"> <strong>Correo Electrónico: </strong></label>
        <label for="" class="label-form col-md-3 col-sm-12"> {{currEmpresa.Admin.Email}}</label>
        <label for="" class="label-form col-md-1 col-sm-12"> <strong>Cédula: </strong></label>
        <label for="" class="label-form col-md-2 col-sm-12"> 
          <span *ngIf="currEmpresa.Admin.Persona.Ci && currEmpresa.Admin.Persona.Ci != ''">{{currEmpresa.Admin.Persona.Ci}}</span>
          <span *ngIf="!(currEmpresa.Admin.Persona.Ci && currEmpresa.Admin.Persona.Ci != '')">Sin Cédula</span>
        </label>
        <label for="" class="label-form col-md-1 col-sm-12"> <strong>Teléfono: </strong></label>
        <label for="" class="label-form col-md-2 col-sm-12"> {{currEmpresa.Admin.Persona.Phone}}</label>
        <label for="" class="label-form col-md-1 col-sm-12"> <strong>Dirección: </strong></label>
        <label for="" class="label-form col-md-5 col-sm-12 pl-md-4"> {{currEmpresa.Admin.Persona.Address  +', En: ' + currEmpresa.Admin.Persona.City.Name + ' - ' + currEmpresa.Admin.Persona.City.Canton.Name + ' - ' + currEmpresa.Admin.Persona.City.Canton.Provincia.Name}}</label>
        <div *ngIf="!currEmpresa.Admin" class="row container">
          <label for="" class="label-form text-right col-md-4 col-sm-12"> <strong>Datos: </strong></label>
          <label for="" class="label-form            col-md-8 col-sm-12"> Sin encargado dentro del Sistema, Agregar un nuevo usuario Manejar la Empresa dentro de Alfibeton</label>
        </div>
      </div>
      <div *ngIf="currEmpresa" class="modal-footer m-0 p-0">
      </div> -->
      <div *ngIf="currEmpresa" class="modal-body container row m-2">
        <h4 class="col-12">
          <strong>Repartidores</strong>
        </h4>
        <table class="col-12 table table-bordered table-striped table-sm table-responsive-sm table-hover">
          <thead>
            <tr>
              <th class="p-0 text-center" rowspan="2">
                Teléfono
              </th>
              <th rowspan="2" class="p-0 text-center">
                Nombres
              </th>
              <th class="p-0 text-center" rowspan="2">
                Cédula
              </th>
              <th colspan="2" class="p-0 text-center">
                Vehículo
              </th>
            </tr>
            <tr>
              <th class="p-0 text-center">
                Tipo
              </th>
              <th class="p-0 text-center">
                Placa
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let motorizado of UsuariosEmpresa">
              <td class="p-0 text-center">
                {{motorizado.Persona.Phone}}
              </td>
              <td class="p-0 text-center">
                {{motorizado.Persona.FirstName + ' ' + motorizado.Persona.LastName}}
              </td>
              <td class="p-0 text-center">
                <span *ngIf="motorizado.Persona.Ci && motorizado.Persona.Ci != ''">
                  {{motorizado.Persona.Ci}}
                </span>
                <span *ngIf="!(motorizado.Persona.Ci && motorizado.Persona.Ci != '')">
                  Sin Cédula
                </span>
              </td>
              <td class="p-0 text-center">
                {{motorizado.RepData.Tipo}}
              </td>
              <td class="p-0 text-center">
                {{motorizado.RepData.Placa}}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-info">Ok</button><button
          type="button" data-dismiss="modal" class="btn btn-default">Close</button></div>
    </div>
  </div>
</div>

<div class="modal fade" id="maps-modal" tabindex="-1" role="dialog" aria-labelledby="modal-info-label">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header state modal-info">
        <h4 class="modal-title" id="modal-info-label">
          <i class="fas fa-map-marked-alt"></i>
          <span *ngIf="!empresa.Address">
            Seleccionar Dirección
          </span>
          <span *ngIf="empresa.Address">
            {{empresa.Address}}
          </span>
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body widget-body">
        <div class="content row pr-3 pl-3">
          <div id="floating-panel" class="col-12 input-group mb-2">
            <div class="input-group-prepend">
              <button class="btn btn-success" id="GetAddress">
                <i class="fas fa-map-marked-alt"></i>
                Buscar!
              </button>
            </div>
            <input id="address" type="textbox" class="form-control"
              placeholder="Buscar dirección, ciudad, cantón, provincia o pais" />
            <!-- <input id="GetAddress" type="button" value="Geocode" /> -->
          </div>
          <div class="col-12 mb-2">
            <div name=MyGoogleMap id=MyGoogleMap style="width: 100%; height: 500px; border-radius: 5px;"></div>
          </div>
          <div class="col-12">
            <div *ngIf="currPosition && currPosition.address_components && currPosition.address_components[0]" role="alert" class="alert alert-success alert-dismissible fade show">
              <!-- <button type="button" data-dismiss="alert" aria-label="Close" class="close">
                <span aria-hidden="true">×</span>
              </button> -->
              <strong>Ubicación Localizada!</strong>
              {{currPosition.address_components[0].long_name}} -
              {{currPosition.address_components[1].long_name}} -
              {{currPosition.address_components[2].long_name}} -
              {{currPosition.address_components[3].long_name}}
              <span *ngIf="currPosition.address_components[4]">
                - {{currPosition.address_components[4].long_name}}
              </span>
              <span *ngIf="currPosition.address_components[5]">
                - {{currPosition.address_components[5].long_name}}
              </span>
            </div>
            <div *ngIf="!currPosition" role="alert" class="alert alert-danger alert-dismissible fade show">
              <!-- <button type="button" data-dismiss="alert" aria-label="Close" class="close">
                <span aria-hidden="true">×</span>
              </button> -->
              <strong>Alerta!</strong> 
              No se ha encontrado la Dirección, prueba ingresandola en el buscador o seleccionandola manualmente. 
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer widget-body">
        <div class="content row">
          <div class="col-12">
            <button id="setCurrentPosition" data-dismiss="modal" aria-label="Close"  class="btn btn-success pull-left" [disabled]="!currPosition">
              <i class="fa fa-save"></i>
              Guardar
            </button>
            <button id="clearInfowidow"  data-dismiss="modal" aria-label="Close" class="btn btn-warning pull-right ml-3" (click)="currPosition = undefined">
              <i class="fa fa-trash"></i>
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>